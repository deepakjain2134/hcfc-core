@model List<HCF.BDO.AllPermits>
@{
    /**/

    ViewBag.Title = "Permits";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int index = 0;
    var selstatus = ViewBag.Status != null ? ViewBag.Status : string.Empty;
    var FilterBy = ViewBag.FilterBy != null ? ViewBag.FilterBy : string.Empty;
    var PermitType = ViewBag.Status != null ? ViewBag.PermitType : string.Empty;
    var ProjectID = ViewBag.ProjectID != null ? ViewBag.ProjectID : string.Empty;
}


    @section pageHeader{
    <section class="content-header">
        <h1>
            Permits
        </h1>
    </section>
        }
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary">
                    <div class="" id="questtblediv">
                        @using (Html.BeginForm("GetAllPermits", "Permit", FormMethod.Get, new { @id = "allpermits" }))
                        {
                            <div class="row" style="display:none;">
                                <input type="hidden" id="FilterBy" name="FilterBy" value="@FilterBy" />
                                <input type="hidden" id="PermitType" name="PermitType" value="@PermitType" />
                                <input type="hidden" id="Status" name="Status" value="@selstatus" />
                                <input type="hidden" id="AllSelected" name="AllSelected" value="0" />
                                <input type="hidden" id="ProjectID" name="ProjectID" value="@ProjectID" />
                                <div class="col-md-6">
                                    <input type="submit" id="btnfilterclick" class="comm-button" value="GO" />
                                </div>
                            </div>
                        }
                        <div class="row tablelist-topform">
                            <div class="col-md-3 col-sm-6" style="padding-bottom:8px;">
                                <strong>Projects:</strong>
                                <icraprojectdropdown name="SelProjectId" selectedvalue="0"
                                                     class="form-control" firsttext="-- All Project --"></icraprojectdropdown>
                                @*@Html.ICRAProjectDropDown("SelProjectId", 0, "-- All Project --", new { @class = "form-control" })*@
                            </div>
                            <div class="col-md-3 col-sm-6" style="padding-bottom:8px;">
                                <strong>Permits:</strong>
                                @*@Html.PermitDropDownList("SelPermitType", 0, "All Permits", true,
                new { @class = "form-control", @required = "required" })*@
                                <permit-drop-down-list firsttext="All Permits" selectedvalue="0" name="SelPermitType" class="form-control" required="required"></permit-drop-down-list>
                            </div>


                            <div class="control-label col-md-3 col-sm-6">
                                <div class="workOrder-status">
                                    <strong>Status:</strong>
                                    <select id="statusId" multiple class="form-control" title="All Status" data-selected-text-format="count > 5">
                                        <option value="-2" class="select-all">All</option>
                                        <option value="2">Requested</option>
                                        <option value="3">Pending</option>
                                        <option value="1">Approved</option>
                                        <option value="0">Rejected</option>
                                        <option value="5">Closed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <strong>Days:</strong>
                                <select id='filterdays' class="form-control">
                                    <option value='-4'>All Days</option>
                                    <option value='90'>90 Days</option>
                                    <option value='60'>60 days</option>
                                    <option value='30'>30 Days</option>
                                    <option value='-3'>This Week Permits</option>
                                    <option value='-2'>Tomorrows Permit</option>
                                    <option value='-1'>Today's Permit</option>






                                </select>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <table id="mopTable" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>Permit #</th>
                                            <th>Project Name</th>
                                            <th>Project #</th>
                                            <th style="width: 122px;">Report Date</th>
                                            <th>Status</th>
                                            <th>Action</th>
                                            <th>More</th>
                                            <th style="display:none"></th>
                                            <th style="display:none"></th>
                                            <th style="display:none"></th>
                                            <th style="display:none"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model)
                                        {
                                            if (!commonModelFactory.IsMenuExist("ICRA", Convert.ToString(session.ClientNo)) && item.PermitType == 11)
                                            {

                                            }
                                            else if (!commonModelFactory.IsMenuExist("PCRA", Convert.ToString(session.ClientNo)) && item.PermitType == 10)
                                            {

                                            }
                                            else
                                            {
                                                <tr>
                                                    @{ index = index + 1;}
                                                    <td>@item.PermitNo</td>
                                                    <td>@item.ProjectName</td>
                                                    <td>
                                                        @item.ProjectNumber
                                                    </td>
                                                    <td data-sort="@item.ReportDate.DateSort()">
                                                        @item.ReportDate.ToFormatDate()
                                                    </td>

                                                    <td>
                                                        <input type="hidden" value="@item.Status" />
                                                        @{
                                                            HCF.BDO.Enums.ApprovalStatus enums = (HCF.BDO.Enums.ApprovalStatus)item.Status;
                                                        }
                                                        <p>@enums.GetDescription()</p>
                                                    </td>
                                                    <td class="allpermit-action mopmoredot">
                                                        @if (item.PermitType == 1)
                                                        {
                                                            <a href="@Url.RouteUrl("updateceilingpermit",new {ceilingPermitId = item.PermitId})"> <span>
                                                                    <img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit" alt="" />
                                                                </span>
                                                            </a>


                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("CeilingPermit", "Pdf", new { ceilingPermitId = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("DownloadCeilingPermitAttachments", "Permit", new { ceilingPermitId = item.PermitId})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>


                                                                </ul>

                                                            </div>

                                                        }
                                                        else if (item.PermitType == 2)
                                                        {
                                                            <a href="@Url.RouteUrl("addfacilitiesmaintenanceoccurrence", new { id = item.PermitId })">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit Permit" alt="3d_add_button" /></span>
                                                            </a>

                                                            <a href="@Url.Action("FMCPermitPdf", "PDF", new { id = item.PermitId })">
                                                                <span>
                                                                    <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                </span>

                                                            </a>


                                                        }
                                                        else if (item.PermitType == 3)
                                                        {



                                                            <a href="@Url.RouteUrl("addmethodofprocedure",new { id=item.PermitId})">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit Permit" alt="3d_add_button" /></span>
                                                            </a>


                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("MethodofprocedurePdf", "Pdf", new { id = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("DownloadMOPAttachments", "Permit", new { id = item.PermitId,IsAttachmentIncluded=true})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>


                                                                </ul>

                                                            </div>

                                                        }
                                                        else if (item.PermitType == 4)
                                                        {


                                                            <a href="@Url.Action("AddFSBPermit", "Permit", new { tfsbPermitId = item.PermitId})">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit" /></span>
                                                            </a>




                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("FireSystemByPassPermitReports", "Pdf", new { tfsbPermitId = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("DownloadFSBPAttachments", "Permit", new { tfsbPermitId = item.PermitId,IsAttachmentIncluded=true})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>


                                                                </ul>

                                                            </div>
                                                        }
                                                        else if (item.PermitType == 5)
                                                        {



                                                            <a href="@Url.RouteUrl("newLsdformadd",new { formId=item.PermitId ,formType=(item.FormType==1)?"addition":"removal"})">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit Permit" alt="3d_add_button" /></span>
                                                            </a>



                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("LifeSafetyFormPdf", "Pdf", new { formId = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("DownloadLSDAttachments", "Permit", new { formId = item.PermitId})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>


                                                                </ul>

                                                            </div>
                                                        }


                                                        else if (item.PermitType == 6)
                                                        {

                                                            <a href="@Url.RouteUrl("newLsdformadd",new { formId=item.PermitId ,formType=(item.FormType==1)?"addition":"removal"})">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit Permit" alt="3d_add_button" /></span>
                                                            </a>



                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("LifeSafetyFormPdf", "Pdf", new { formId = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("DownloadLSDAttachments", "Permit", new { formId = item.PermitId})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>


                                                                </ul>

                                                            </div>
                                                        }


                                                        else if (item.PermitType == 7)
                                                        {

                                                            <a href="@Url.Action("AddHotWorkPermit", "HotWorkPermit",new {projectid=item.ProjectId,thotworkpermitid=item.PermitId, mode="edit"})">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit Hot Work Permit" alt="3d_add_button" /></span>
                                                            </a>



                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("HotWorkPermitPdf", "Pdf", new { thotworkpermitid = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("HotWorkPermitPdf", "Pdf", new { thotworkpermitid = item.PermitId,IsAttachmentIncluded=true})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 8)
                                                        {

                                                            <img onclick="location.href ='@Url.Action("AddCRA", "PCRA", new {projectId=item.ProjectId, tpcraquestid = item.PermitId, mode="edit"})'" src="@Url.Content("~/dist/Images/Icons/edit_button2.png")" title="Edit" alt="Edit" />
                                                            <div class="allpermit-Disabledicon" title="@(item.TicraId==0? "ICRA permit is not linked with this CRA" :"")">

                                                                <a class="@(item.TicraId==0 ? "disable" :"")" onclick="Printpermit(@index)">
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </a>
                                                            </div>

                                                        }
                                                        else if (item.PermitType == 10)
                                                        {

                                                            <a href="@Url.Action("AddPCRA", "PCRA",new {projectId=item.ProjectId, tpcraquestid = item.PermitId, mode="edit"})">
                                                                <span><img src="@Url.Content(HCF.Web.Models.ImagePathModel.EditIcon)" title="Edit Question PCRA" alt="3d_add_button" /></span>
                                                            </a>



                                                            <div class="dropdown icratable-drop icondpwnload">
                                                                <button class="dropdown-toggle" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                    <span>
                                                                        <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                    </span>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("PrintPCRAPdf", "Pdf" ,new {projectId=item.ProjectId, tPCRAQuesId = item.PermitId,IsAttachmentIncluded=false})">
                                                                            <span>
                                                                                Export permit as PDF
                                                                            </span>
                                                                        </a>

                                                                    </li>

                                                                    <li data-action="icrapermit">
                                                                        <a href="@Url.Action("PrintPCRAPdf", "Pdf",new {projectId=item.ProjectId, tPCRAQuesId = item.PermitId,IsAttachmentIncluded=true})">
                                                                            <span>
                                                                                Export permit as PDF w/ attachments
                                                                            </span>
                                                                        </a>

                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 11)
                                                        {
                                                            <img onclick="location.href ='@Url.Action("AddInspectionIcra", "ICRA", new { icraId = item.PermitId , iseditable = true,version=item.Version })'" src="@Url.Content("~/dist/Images/Icons/edit_button2.png")" title="Edit" alt="Edit" />
                                                            <a onclick="Printpermit(@index)">
                                                                <span>
                                                                    <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                </span>

                                                            </a>

                                                        }
                                                        else if (item.PermitType == 12)
                                                        {
                                                            <img onclick="location.href ='@Url.Action("AddInspectionIcra", "ICRA", new { icraId = item.PermitId , iseditable = true,version=item.Version })'" src="@Url.Content("~/dist/Images/Icons/edit_button2.png")" title="Edit" alt="Edit" />
                                                            <a onclick="Printpermit(@index)">
                                                                <span>
                                                                    <img src="~/dist/Images/Icons/pdf_icon.png" title="Download Pdf" alt="" />
                                                                </span>

                                                            </a>

                                                        }
                                                    </td>
                                                    <td class="text-center">
                                                        @if (item.PermitType == 1 || item.PermitType == 2 || item.PermitType == 3
                                                        ||item.PermitType == 4 || item.PermitType == 5 || item.PermitType == 10 || item.PermitType == 7
                                                        )
                                                        {
                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@(item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                       @* else if (item.PermitType == 2)
                                                        {
                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@(item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 3)
                                                        {
                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@( item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 4)
                                                        {
                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@(item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 5)
                                                        {

                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@( item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 6)
                                                        {
                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@(item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 10)
                                                        {

                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@( item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span> Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }
                                                        else if (item.PermitType == 7)
                                                        {
                                                            <div class="dropdown icratable-drop">
                                                                <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                                </button>
                                                                <ul class="dropdown-menu ctmenu">
                                                                    <li data-action="deletepermit">
                                                                        <a data-id="@item.PermitId" data-permittype="@item.PermitType" class="@( item.Status!=1? "deletepermit" :"deletepermit disable")">
                                                                            <span>Delete Permit</span>
                                                                        </a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        }*@
                                                        else if (item.PermitType == 8)
                                                        {

                                                        <div class="dropdown icratable-drop">
                                                            <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                            </button>
                                                            @await Html.PartialAsync("~/Views/Shared/_pcramoreoption.cshtml",
                                                new ViewDataDictionary(
                                                new Microsoft.AspNetCore.Mvc.ModelBinding.EmptyModelMetadataProvider(),
                                                new Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary())
                                                {{ "icraId", item.TicraId },
                                                { "ProjectId", item.ProjectId },
                                                { "TPCRAQuesId", item.PermitId },
                                                { "permitno", item.PermitNo },
                                                { "permittype", item.PermitType },
                                                { "index", index },
                                                { "status", item.Status },
                                                { "IsAllPermit", "1" }}
                                                )

                                                        </div>

                                                        }                                                       
                                                        else if (item.PermitType == 11)
                                                        {
                                                        <div class="dropdown icratable-drop">
                                                            <button class="btn dropdown-toggle dot-icons" type="button" data-toggle="dropdown">
                                                                <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                                            </button>
                                                            @await Html.PartialAsync("~/Views/Shared/_icramoreoption.cshtml",
                                                new ViewDataDictionary(
                                                new Microsoft.AspNetCore.Mvc.ModelBinding.EmptyModelMetadataProvider(),
                                                new Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary())
                                                {{ "icraId", item.PermitId }, { "permitno", item.PermitNo },
                                                { "permittype", item.PermitType }, { "index", index }, { "status", item.Status }, { "IsAllPermit", "1" } }
                                                )

                                                        </div>
                                                        }
                                                    </td>
                                                    <td style="display:none">@item.CreatedDateDiff</td>
                                                    <td style="display:none">@item.PermitType</td>
                                                    <td style="display:none">@item.Status</td>
                                                    <td style="display:none">@item.ProjectId</td>

                                                </tr>
                                            }

                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

    var selprojectId = $("#SelProjectId");
    var statusId = $("#statusId");

    var PermitType = $("#SelPermitType");
    var mopTable = $('#mopTable').DataTable({
        "lengthChange": false,
        "ordering": true,
        "pageLength": 20,
        "lengthChange": false,
        "bPaginate": $('#mopTable tbody tr').length > 20,
        "bInfo": true,
        "aaSorting": [],
        "order": [[3, "desc"]],
        language: {
            emptyTable: "No data available in table",
            search: "_INPUT_", //To remove Search Label
            searchPlaceholder: "Search..."
        },
        //dom: "<'row'<'col-sm-3'l><'col-sm-3'><'col-sm-6'p>>" +
        //    "<'row'<'col-sm-12'<'table-responsive'tr>>>" +
        //    "<'row'<'col-sm-5 text-right'i>>" + "Blfrtip",

        dom: "<'row'<'col-sm-2'B><'col-sm-2'l><'col-sm-8 tableactions'flp <'toolbar'>>>" + "<'row'<'col-md-12'<'table-responsive'tr> > >" + "<'row'<'col-sm-12 text-right'p>>",




         buttons: [
            {
                extend: 'pdfHtml5',
                orientation: 'portrait',
                //pageSize:'LEGAL',
                title: 'All Permit Report',
                exportOptions: {
                    columns: [0, 1, 2, 3, 4]
                },
                messageBottom: function () {
                    return $("#dvgeneratedby").text();
                },
                customize: function (doc) {
                    //genereateRpeort(doc)
                    //Remove the title created by datatTables
                    doc.content.splice(0, 1);
                    //Create a date string that we use in the footer. Format is dd-mm-yyyy
                    var now = new Date();
                    var jsDate = setDateFormat(now);
                    //var jsDate = now.getDate() + '-' + (now.getMonth() + 1) + '-' + now.getFullYear();
                    // Logo converted to base64
                    //var logo = $("#logoimgbase64").val();
                    debugger;
                    var logo = localStorage.getItem("logoimgbase64");//getBase64FromImageUrl();
                    //console.log(logo);
                    // The above call should work, but not when called from codepen.io
                    // So we use a online converter and paste the string in.
                    // Done on http://codebeautify.org/image-to-base64-converter
                    // It's a LONG string scroll down to see the rest of the code !!!
                    //var logo = '';
                    // A documentation reference can be found at
                    // https://github.com/bpampuch/pdfmake#getting-started
                    // Set page margins [left,top,right,bottom] or [horizontal,vertical]
                    // or one number for equal spread
                    // It's important to create enough space at the top for a header !!!
                    doc.pageMargins = [20, 60, 20, 30];
                    // Set the font size fot the entire document
                    doc.defaultStyle.fontSize = 12.5;
                    // Set the fontsize for the table header
                    doc.styles.tableHeader.fontSize = 12.5;
                    // Create a header object with 3 columns
                    // Left side: Logo
                    // Middle: brandname
                    // Right side: A document title
                    doc['header'] = (function () {
                        return {
                            columns: [
                                { image: logo, width: 40 },
                                {
                                    alignment: 'left',
                                    italics: true,
                                    text: ('@HCF.Web.Base.UserSession.CurrentOrg'!=null ?getOrgName('@HCF.Web.Base.UserSession.CurrentOrg.Name'):""), @*text: '@HCF.Web.Base.UserSession.CurrentOrg.Name',*@
                                    fontSize: 15,
                                    margin: [0, 6, 0, 0],
                                    width: 200,
                                },
                                {
                                    alignment: 'middle',
                                    fontSize: 15,
                                    text: 'All Permit Report',
                                    margin: [0, 6, 0, 0]
                                }
                            ],
                            margin: 20
                        }
                    });

                    doc['footer'] = (function (page, pages) {
                        return {
                            columns: [
                                {
                                    alignment: 'left',
                                    text: ['Created on: ', { text: jsDate.toString() }]
                                },
                                {
                                    alignment: 'right',
                                    text: ['Generated from: ', { text: 'CRx' }]
                                },
                                {
                                    alignment: 'right',
                                    text: ['Generated by: ', { text: ('@HCF.Web.Base.UserSession.CurrentUser'!=null ?'@HCF.Web.Base.UserSession.CurrentUser.Name':"") }]
                                },
                                {
                                    alignment: 'right',
                                    text: [{ text: page.toString() }, ' of ', { text: pages.toString() }]
                                }
                            ],
                            margin: 20
                        }
                    });

                    var objLayout = {};
                    objLayout['hLineWidth'] = function (i) { return .5; };
                    objLayout['vLineWidth'] = function (i) { return .5; };
                    objLayout['hLineColor'] = function (i) { return '#aaa'; };
                    objLayout['vLineColor'] = function (i) { return '#aaa'; };
                    objLayout['paddingLeft'] = function (i) { return 4; };
                    objLayout['paddingRight'] = function (i) { return 4; };
                    doc.content[0].layout = objLayout;
                }
            },
            {
                extend: 'excel',
                title: 'All Permit Report',
                messageBottom: function () {
                    return $("#dvgeneratedby").text();
                },
                exportOptions: {
                    columns: [0, 1, 2, 3, 4],
                    orthogonal: 'export'
                }
            }
        ]
    });
    $("#SelPermitType").change(function () {
        var PermitType = $("#SelPermitType").val();
        $("#SelPermitType").val(PermitType);
        $("#PermitType").val(PermitType);
        $("#btnfilterclick").click();
    });
    $(document).ready(function () {


        RefreshStatus();

        var projectId = parseInt(getParameterByName('ProjectId'));
        debugger;
        var FilterBy = getParameterByName('FilterBy');
        if (FilterBy != undefined && (FilterBy!=null && FilterBy!="")) {
            $("#filterdays").val(FilterBy);
        }
        else {
            $("#filterdays").val("30");
        }

        if ($("#PermitType").val() != null && $("#PermitType").val() != "") {
            $("#SelPermitType").val($("#PermitType").val())
        }
        if ($("#FilterBy").val() != null && $("#FilterBy").val() != "") {
            $("#FilterBy").val($("#FilterBy").val())
        }       
        if ($("#ProjectID").val() != null && $("#ProjectID").val() != "") {
            if ($("#ProjectID").val() == "0") {
                $("#SelProjectId").val("");
            }
            else {
                $("#SelProjectId").val($("#ProjectID").val());
            }

        }

        $('.formIcons').click(function () {
            $(this).toggleClass("active");
            var array = [];
            $('.formIcons').each(function () {
                if ($(this).hasClass('active')) {
                    array.push($(this).attr("formType"));
                }
            });
            console.log(array.join('|'));
            if (array.length == 0) {
                array.push(2);
            }
            mopTable.column(0).search(array.join('|'), true, false, true).draw();
        });
        $(".dataTables_info").parent(".col-sm-5").hide();
        $(".printpermit").hide();
        if ('@commonModelFactory.IsMenuExist("ICRA", Convert.ToString(session.ClientNo))' == 'False') {
            $("#SelPermitType>option[value=11]").hide();
        }
        if ('@commonModelFactory.IsMenuExist("PCRA", Convert.ToString(session.ClientNo))' == 'False') {
            $("#SelPermitType>option[value=10]").hide();
        }

    });

    selprojectId.change(function () {      
        var projectId = selprojectId.val();
        //filterRecords(projectId);
        $("#ProjectID").val(projectId);
        $("#btnfilterclick").click();
    })
    $("#filterdays").change(function () {
        debugger;
        var days = $("#filterdays").val();
        FilterAllPermits(days);
    });

    statusId.on('change', function () {
        debugger;
        var selected = [];
        var options = $(this).find("option").length-1;
        if ($(this).find("option:first:selected").length == 0 && ($("#AllSelected").val() == "0" || $("#AllSelected").val() == "1" )) {
            $("#Status").val("");

        }
        else if ($(this).find("option:selected").length == options && $(this).find("option:first:selected").length == 1)
        {

            $(this).find("option:selected").each(function (key, ctr) {
                selected.push(ctr.value);
                //selected.push("'" + ctr.value + "'");
            });
            var values = selected.toString(",");
            values = values.replace("-2,", "");
            $("#Status").val(values);
        }
        else {

            $(this).find("option:selected").each(function (key, ctr) {
                selected.push(ctr.value);
                //selected.push("'" + ctr.value + "'");
            });
            var values = selected.toString(",");
            $("#Status").val(values);
            if (selected.length > 0 && selected[0] == "-2") {
                $("#Status").val("-2,0,1,2,3,5");
            }
        }

        RefreshStatus();

       $("#btnfilterclick").click();

    });

    function RefreshStatus() {
        var status = $("#Status").val();
        var selectedCode = [];
        wostatusIds = status;
        if (wostatusIds.length > 0) {
            selectedCode = wostatusIds.split(',').map(function (item) {
                return (item);
            });
        }
        $("#statusId").selectpicker();
        $("#statusId").selectpicker('val', selectedCode)
        $("#statusId").selectpicker('refresh');
        if (selectedCode == "") {
            $("#AllSelected").val("-1");

        }
        else if (selectedCode.includes("-2"))
            $("#AllSelected").val("1");
        else
            $("#AllSelected").val("-1");

        console.log($("#Status").val());
    }
    function FilterAllPermits(FilterBy) {        
        switch (FilterBy) {
            case "-1":
                $("#FilterBy").val(-1)
                break;
            case "-2":
                $("#FilterBy").val(-2)
                break;
            case "-3":
                $("#FilterBy").val(-3)
                break;
            default:
                $("#FilterBy").val(FilterBy)
                break;

        }

        $("#btnfilterclick").click();
    }


    $(document).on('click', 'a.deletepermit', function (e) {
        debugger;
        e.preventDefault();
        var Id = $(this).data("id");
        var permittype = $(this).data("permittype");
        swal({
            title: "Are you sure?",
            text: "Do you want to delete this permit?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, delete it!",
            closeOnConfirm: false
        },
            function () {
                $.ajax({
                    type: "GET",
                    url: CRxUrls.Permit_Delete + "?id=" + Id + "&permittype=" + permittype,
                    success: function (data) {
                        swal("Deleted!", "Your permit has been deleted.", "success");
                        location.reload();
                    },
                    dataType: "json",
                    traditional: true
                });
            });
    });
    function Printpermit(index) {
        $("#icrapermit_" + index).submit();
    }

    </script>