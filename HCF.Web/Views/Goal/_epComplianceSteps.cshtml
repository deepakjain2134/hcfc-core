@model  List<HCF.BDO.EPSteps>

@{
    var StepCount = 1;
    bool ishistory = this.ViewData.ContainsKey("ishistory") ? Convert.ToBoolean(this.ViewData["ishistory"]) : false;

    var epdocument = Model.FirstOrDefault().epdocument;
    var assetsid = Model.FirstOrDefault().epdetials;
    int inspectionid = this.ViewData.ContainsKey("inspectionId") ? Convert.ToInt32(this.ViewData["inspectionId"].ToString()) : 0;

}
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<html>
<div class="row">
    <div class="col-md-12">
        <div class="epStepsBox listBullet">
            <input type="hidden" id="rbnUploadtype" name="rbnUploadtype" />
            <h5>EP Compliance Steps</h5>
            @if (Model.FirstOrDefault().IsDocRequired && Model.FirstOrDefault().IsAssetEP)
            {
                if (Model.FirstOrDefault().EPDetails.DocStatus == 1 && Model.FirstOrDefault().IsAllAssetsdone == 1 && Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN")
                {
                    <div class="epSteps-listBox">
                        <div class="epStepsCol1">
                            <img src="/dist/Images/Icons/epdocSteps-check.png" />
                        </div>
                        <div class="epStepsCol2">
                            <h4>
                                Step <span>@StepCount</span>: This EP requires a document.Please upload the <span class="NotClick">@Model.FirstOrDefault().DocName</span>
                                <a href="@Url.Action("Inspection", "Assets", new {area = "",assetsid = assetsid?.Assets?.FirstOrDefault()?.AssetId,epdetailid= Model.FirstOrDefault().EPDetailId,inspectionid= inspectionid >0?inspectionid: 0})" id="btnAddDoc1"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a>
                            </h4>
                            <div class="epdetailsBox-row">
                                @if (epdocument.Any())
                                {
                                    <div class="ep-tableBox requireddoc">
                                        <div class="">
                                            @foreach (var epdocs in epdocument.Where(x => x.DocTypeId != 108 && x.IsDeleted == false || (x.CreatedBy == 0)).OrderByDescending(x => x.CreatedDate))
                                            {
                                                var filePath = (epdocs.IsDeleted) ? string.Empty : epdocs.Path;

                                                <div class="epdocSteps-doc @((epdocs.IsDeleted) ? "deleted" : "")">
                                                    <span class="epdocol1">
                                                        @if (epdocs.IsDeleted)
                                                        {
                                                            <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                        }
                                                        else
                                                        {
                                                            <a href="@Url.Action("ImagePreview", "Common", new { imgSrc = filePath, title = "Preview" })" class="modal-link" title="View">
                                                                <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                            </a>
                                                        }
                                                    </span>
                                                    <div class="epdocol2 gray" style="display: inline-flex;">
                                                        <span class="epfileBox" title="@($"{epdocs.DocumentName}")">@($"{epdocs.DocumentName}")</span>
                                                        <span>Doc. Review Date:&nbsp;</span>@epdocs.DtEffectiveDate.ToFormatDate() &nbsp;|&nbsp;
                                                        <span>@(epdocs.UserProfile.UserId > 0 ? "Uploaded By:" : "Generated By:") &nbsp; </span>@($"{commonModelFactory.setUserName(epdocs.UserProfile)}")&nbsp;<span>on</span>&nbsp;
                                                        @($"{epdocs.CreatedDate.ToFormatDate()}")
                                                        <a href="#" activityId='@epdocs.ActivityId' title="Delete" class="@(epdocs.IsDeleted ? "delete hide" : "delete")">
                                                            <img src="/dist/Images/Icons/delete.png" alt="Delete">
                                                        </a>
                                                    </div>
                                                    <div class="epdocol3">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>

                            <div class="epdetailsBox-row">
                                <div class="ep-tableBox requireddoc" style="border:none;">
                                    <h4 class="ep-detailsOr">OR</h4>
                                    <div class="epdocSteps-doc">
                                        <div class="epdocol2">
                                            <h4 class="withincrx">Inspect assets within CRx</h4>
                                        </div>
                                        <div class="epdocol1">
                                            <h4>&nbsp;</h4>
                                        </div>
                                        <div class="epdocol3">
                                            <button class="float-right" type="button" name="ModalPopUpAssets" id="ModalPopUpAssets"><img src="/dist/Images/Icons/search_icon.png" /></button>
                                        </div>
                                    </div>
                                </div>
                            </div>





                        </div>
                    </div>
                    StepCount = StepCount + 1;
                }
                else
                {
                    <div class="epSteps-listBox">
                        <div class="epStepsCol1">
                            <img src="/dist/Images/Icons/epdocSteps-uncheck.png" />
                        </div>
                        <div class="epStepsCol2">
                            <h4>Step <span>@StepCount</span>: This EP requires a document. Please upload the <span class="NotClick">@Model.FirstOrDefault().DocName</span><a href="@Url.Action("Inspection", "Assets", new {area = "",assetsid = assetsid?.Assets?.FirstOrDefault()?.AssetId,epdetailid= Model.FirstOrDefault().EPDetailId,inspectionid= inspectionid >0?inspectionid: 0})" id="btnAddDoc1"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a></h4>
                            @if (Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN")
                            {
                                <div class="epdetailsBox-row">
                                    @if (epdocument.Any())
                                    {
                                        <div class="ep-tableBox requireddoc">
                                            <div class="">
                                                @foreach (var epdocs in epdocument.Where(x => x.DocTypeId != 108 && x.IsDeleted == false || (x.CreatedBy == 0)).OrderByDescending(x => x.CreatedDate))
                                                {
                                                    var filePath = (epdocs.IsDeleted) ? string.Empty : epdocs.Path;

                                                    <div class="epdocSteps-doc @((epdocs.IsDeleted) ? "deleted" : "")">
                                                        <span class="epdocol1">
                                                            @if (epdocs.IsDeleted)
                                                            {
                                                                <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                            }
                                                            else
                                                            {
                                                                <a href="@Url.Action("ImagePreview", "Common", new { imgSrc = filePath, title = "Preview" })" class="modal-link" title="View">
                                                                    <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                                </a>
                                                            }
                                                        </span>
                                                        <div class="epdocol2 gray" style="display:inline-flex;">
                                                            <span class="epfileBox" title="@($"{epdocs.DocumentName}")">@($"{epdocs.DocumentName}")</span>
                                                            <span>Doc. Review Date:&nbsp;</span>@epdocs.DtEffectiveDate.ToFormatDate() &nbsp;|&nbsp;
                                                            <span>Uploaded By:&nbsp;</span>@($"{epdocs.UserProfile.FullName}")&nbsp;<span>on</span>&nbsp;
                                                            @($"{epdocs.CreatedDate.ToFormatDate()}")
                                                            <a href="#" activityId='@epdocs.ActivityId' title="Delete" class="@(epdocs.IsDeleted ? "delete hide" : "delete")">
                                                                <img src="/dist/Images/Icons/delete.png" alt="Delete">
                                                            </a>
                                                        </div>
                                                        <div class="epdocol3">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            <div class="epdetailsBox-row">
                                <div class="ep-tableBox requireddoc" style="border:none;">
                                    <h4 class="ep-detailsOr">OR</h4>
                                    <div class="epdocSteps-doc">
                                        <div class="epdocol2">
                                            <h4 class="withincrx">Inspect assets within CRx</h4>
                                        </div>
                                        <div class="epdocol1">
                                            <h4>&nbsp;</h4>
                                        </div>
                                        <div class="epdocol3">
                                            @*<a  id="ModalPopUpAssets" class="inspEP"><img src="/dist/Images/Icons/search_icon.png" /></a>*@
                                            <button class="float-right" type="button" name="ModalPopUpAssets" id="ModalPopUpAssets"><img src="/dist/Images/Icons/search_icon.png" /></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    StepCount = StepCount + 1;
                }
            }
            else
            {

                if (Model.FirstOrDefault().IsDocRequired)
                {
                    if (Model.FirstOrDefault().EPDetails.DocStatus == 1 && Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN")
                    {
                        <div class="epSteps-listBox">
                            <div class="epStepsCol1">

                                <img src="/dist/Images/Icons/epdocSteps-check.png" />
                            </div>
                            <div class="epStepsCol2">
                                <h4>Step <span>@StepCount</span>: This EP requires a document. <span class="NotClick">@Model.FirstOrDefault().DocName</span><a href="#" id="btnAddDoc"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a></h4>
                                <div class="epdetailsBox-row">
                                    @if (epdocument.Any(x => x.IsRequiredDoc))
                                    {
                                        <div class="ep-tableBox requireddoc">
                                            <div class="">
                                                @foreach (var epdocs in epdocument.Where(x => x.DocTypeId != 108 && x.IsDeleted == false).OrderByDescending(x => x.CreatedDate))
                                                {
                                                    var filePath = (epdocs.IsDeleted) ? string.Empty : epdocs.Path;

                                                    <div class="epdocSteps-doc @((epdocs.IsDeleted) ? "deleted" : "")">
                                                        <span class="epdocol1">
                                                            @if (epdocs.IsDeleted)
                                                            {
                                                                <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                            }
                                                            else
                                                            {
                                                                <a href="@Url.Action("ImagePreview", "Common", new { imgSrc = filePath, title = "Preview" })" class="modal-link" title="View">
                                                                    <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                                </a>
                                                            }
                                                        </span>
                                                        <div class="epdocol2 gray" style="display:inline-flex;">
                                                            <span class="epfileBox" title="@($"{epdocs.DocumentName}")">@($"{epdocs.DocumentName}")</span>
                                                            <span>Doc. Review Date:&nbsp;</span>@epdocs.DtEffectiveDate.ToFormatDate() &nbsp;|&nbsp;
                                                            <span>Uploaded By:&nbsp;</span>@($"{epdocs.UserProfile.FullName}")&nbsp;<span>on</span>&nbsp;
                                                            @($"{epdocs.CreatedDate.ToFormatDate()}")
                                                            <a href="#" activityId='@epdocs.ActivityId' title="Delete" class="@(epdocs.IsDeleted ? "delete hide" : "delete")">
                                                                <img src="/dist/Images/Icons/delete.png" alt="Delete">
                                                            </a>
                                                        </div>
                                                        <div class="epdocol3">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        StepCount = StepCount + 1;
                    }
                    else
                    {
                        <div class="epSteps-listBox">
                            <div class="epStepsCol1">
                                @*@if (epdocument.Any(x => x.IsRequiredDoc))
                            {
                                <img src="/dist/Images/Icons/epdocSteps-check.png" />
                            }
                            else
                            {*@
                                <img src="/dist/Images/Icons/epdocSteps-uncheck.png" />

                                @*}*@

                            </div>
                            <div class="epStepsCol2">
                                <h4>Step <span>@StepCount</span>: This EP requires a document. Please upload the <span class="NotClick">@Model.FirstOrDefault().DocName</span><a href="#" id="btnAddDoc"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a></h4>

                                @if (Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN")
                                {
                                    <div class="epdetailsBox-row">
                                        @if (epdocument.Any(x => x.IsRequiredDoc))
                                        {
                                            <div class="ep-tableBox requireddoc">
                                                <div class="">
                                                    @foreach (var epdocs in epdocument.Where(x => x.DocTypeId != 108 && x.IsDeleted == false).OrderByDescending(x => x.CreatedDate))
                                                    {
                                                        var filePath = (epdocs.IsDeleted) ? string.Empty : epdocs.Path;

                                                        <div class="epdocSteps-doc @((epdocs.IsDeleted) ? "deleted" : "")">
                                                            <span class="epdocol1">
                                                                @if (epdocs.IsDeleted)
                                                                {
                                                                    <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                                }
                                                                else
                                                                {
                                                                    <a href="@Url.Action("ImagePreview", "Common", new { imgSrc = filePath, title = "Preview" })" class="modal-link" title="View">
                                                                        <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                                    </a>
                                                                }
                                                            </span>
                                                            <div class="epdocol2  @((epdocs.ExpiredDate < DateTime.Now) ? "red" : Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN" ? "gray" : "green")" style="display:inline-flex;">
                                                                <span class="epfileBox" title="@($"{epdocs.DocumentName}")">@($"{epdocs.DocumentName}")</span>
                                                                <span>Doc. Review Date:&nbsp;</span>@epdocs.DtEffectiveDate.ToFormatDate() &nbsp;|&nbsp;
                                                                <span>Uploaded By:&nbsp; </span>@($"{epdocs.UserProfile.FullName}")&nbsp;<span>on</span>&nbsp;
                                                                @($"{epdocs.CreatedDate.ToFormatDate()}")
                                                                <a href="#" activityId='@epdocs.ActivityId' title="Delete" class="@(epdocs.IsDeleted ? "delete hide" : "delete")">
                                                                    <img src="/dist/Images/Icons/delete.png" alt="Delete">
                                                                </a>
                                                            </div>
                                                            <div class="epdocol3">
                                                                &nbsp;
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                        StepCount = StepCount + 1;
                    }
                }
                if (Model.FirstOrDefault().IsAssetEP)
                {
                    if (Model.FirstOrDefault().IsAllAssetsdone == 1 && Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN")
                    {
                        <div class="epSteps-listBox">
                            <div class="epStepsCol1">
                                <img src="/dist/Images/Icons/epdocSteps-check.png" />
                            </div>
                            <div class="epStepsCol2">
                                <div class="epdetailsBox-row">
                                    <div class="epdocSteps-doc">
                                        <div class="epdocol2"><h4>Step <span>@StepCount</span>: This EP requires  assets  inspection , Inspect within CRx </h4></div>
                                        <div class="epdocol1"></div>
                                        <div class="epdocol3">
                                            @if (Model.FirstOrDefault().IsCurrentCycle == 1)
                                            {
                                                <button class="float-right" type="button" name="ModalPopUpAssets" id="ModalPopUpAssets"><img src="/dist/Images/Icons/search_icon.png" /></button>
                                            }
                                            else
                                            {
                                                <a href="@Url.Action("Inspection", "Assets", new {area = "",assetsid = assetsid?.Assets?.FirstOrDefault()?.AssetId,epdetailid= Model.FirstOrDefault().EPDetailId,inspectionid= inspectionid >0?inspectionid: 0})" id="btnAddDoc1"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a>
                                            }
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        StepCount = StepCount + 1;
                    }

                    else
                    {
                        <div class="epSteps-listBox">
                            <div class="epStepsCol1">
                                <img src="/dist/Images/Icons/epdocSteps-uncheck.png" />
                            </div>
                            <div class="epStepsCol2">
                                <div class="epdetailsBox-row">
                                    <div class="epdocSteps-doc">
                                        <div class="epdocol2"><h4>Step <span>@StepCount</span>: This EP requires  assets  inspection , Inspect within CRx </h4></div>
                                        <div class="epdocol1"></div>
                                        <div class="epdocol3">
                                            @if (Model.FirstOrDefault().IsCurrentCycle == 1)
                                            {
                                                <button class="float-right" type="button" name="ModalPopUpAssets" id="ModalPopUpAssets"><img src="/dist/Images/Icons/search_icon.png" /></button>
                                            }
                                            else
                                            {
                                                <a href="@Url.Action("Inspection", "Assets", new {area = "",assetsid = assetsid?.Assets?.FirstOrDefault()?.AssetId,epdetailid= Model.FirstOrDefault().EPDetailId,inspectionid= inspectionid >0?inspectionid: 0})" id="btnAddDoc1"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a>
                                            }

                                        </div>
                                    </div>
                                </div>



                            </div>
                        </div>
                        StepCount = StepCount + 1;
                    }
                }



            }

            @if (Model.FirstOrDefault().EPDetails.Inspection.SubStatus == "IN" && epdocument.Any(x => x.DocTypeId == 108))
            {
                <div class="epSteps-listBox">
                    <div class="epStepsCol1">
                        @*<img src="/dist/Images/Icons/epdocSteps-check.png" />*@
                    </div>
                    <div class="epStepsCol2">
                        <h4>Step <span>@StepCount</span>: Add miscellaneous documents (optional) <a href="#" id="btnAddDocMisc"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a></h4>
                        @if (epdocument.Any(x => x.DocTypeId == 108))
                        {
                            <div class="ep-tableBox miscdoc">
                                <div class="">
                                    @foreach (var epdocs in epdocument.Where(x => x.DocTypeId == 108 && x.CreatedBy > 0 && x.IsDeleted == false).OrderByDescending(x => x.CreatedDate))
                                    {
                                        var filePath = (epdocs.IsDeleted) ? string.Empty : epdocs.Path;

                                        <div class="epdocSteps-doc @((epdocs.IsDeleted) ? "deleted" : "")">
                                            <span class="epdocol1">
                                                @if (epdocs.IsDeleted)
                                                {
                                                    <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                }
                                                else
                                                {
                                                    <a href="@Url.Action("ImagePreview", "Common", new { imgSrc = filePath, title = "Preview" })" class="modal-link" title="View">
                                                        <img src="/dist/Images/Icons/detail_icon.png" class="epdoc-responsive" />
                                                    </a>
                                                }
                                            </span>
                                            <div class="epdocol2 gray" style="display:inline-flex;">
                                                <span class="epfileBox" title="@($"{epdocs.DocumentName}")">@($"{epdocs.DocumentName}")</span>
                                                <span>Uploaded By: &nbsp;</span>@($"{epdocs.UserProfile.FullName}") &nbsp;
                                                <span>on &nbsp;</span>
                                                @($"{epdocs.CreatedDate.ToFormatDate()}")
                                                <a href="#" activityId='@epdocs.ActivityId' title="Delete" class="@(epdocs.IsDeleted ? "delete hide" : "delete")">
                                                    <img src="/dist/Images/Icons/delete.png" alt="Delete">
                                                </a>
                                            </div>
                                            <div class="epdocol3">
                                                &nbsp;
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>

                </div>
                StepCount = StepCount + 1;
            }
            else
            {
                <div class="epSteps-listBox">
                    <div class="epStepsCol1">
                        @*<img src="/dist/Images/Icons/epdocSteps-uncheck.png" />*@
                    </div>
                    <div class="epStepsCol2">
                        <h4>Step <span>@StepCount</span>: Add miscellaneous documents (optional)<a href="#" id="btnAddDocMisc"><img src="/dist/Images/Icons/epdocSteps-heading.png" class="epdoc-heading" /></a></h4>
                    </div>
                </div>
                StepCount = StepCount + 1;
            }

            <div class="epSteps-listBox">
                <div class="epStepsCol1">
                    <img id="epstepsfinal" src="/dist/Images/Icons/epdocSteps-uncheck.png" />
                </div>
                <div class="epStepsCol2">
                    <h4>Step <span>@StepCount</span>: Review the EP checkpoints below</h4>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="ModalPopUp" role="dialog">
    <div class="modal-dialog err-pop model_big">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    Inspection
                    <button id="DivClose" type="button" class="close" data-dismiss="modal">&times;</button>
                </h4>
            </div>
            <div class="modal-body">
                <div class="EPstate-Insperow">
                    <div class="card">
                        <img class="inspQuestionimg" alt="Upload Inspection" src="https://files.crxweb.com/static/images/services/inspect_by_asset_id_icon.png">
                        <h4>Inspect By Asset ID</h4>
                        <a href="@Url.Action("AssetView", "Assets", new {area = "",assetsid = assetsid?.Assets?.FirstOrDefault()?.AssetId,assettypeid =assetsid?.Assets?.FirstOrDefault()?.AssetTypeId,epdetailid=Model?.FirstOrDefault()?.EPDetailId,inspectionid= inspectionid >0?inspectionid: 0})" class="btn button1">Inspect</a>
                    </div>
                    @if (Model.FirstOrDefault()?.EPDetails?.Assets?.FirstOrDefault()?.IsRouteInsp == true)
                    {
                        <div class="card">
                            <img class="inspQuestionimg" alt="Route Based Inspection" src="https://files.crxweb.com/static/images/services/route_based_inspection.png">
                            <h4>Route Based Inspection</h4>
                            @*<a href="@Url.Action("RedirectRoute", "Common", new { routeName = "routeInspection" , assetsid=assetsid?.Assets?.FirstOrDefault()?.AssetId })" class="btn button1">Inspect</a>*@
                            @*<a href="@Url.Action("routeInspection", "Building", new {area = "RoundInsp",assetsid=assetsid?.Assets?.FirstOrDefault()?.AssetId})" class="btn button1">Inspect</a>*@
                            <a href="@Url.Action("Index", "FireExtinguisher", new {area = "RoundInsp",floorId=0,inspType = 0,assetId=assetsid?.Assets?.FirstOrDefault()?.AssetId,routeId =0,epdetailId=Model.FirstOrDefault().EPDetails.EPDetailId, inspectionid= inspectionid >0?inspectionid: 0})" class="btn button1">Inspect</a>
                        </div>
                    }

                    <div class="card">
                        <img class="inspQuestionimg" alt="Inspection" src="https://files.crxweb.com/static/images/services/inspection_icon.png">
                        <h4>Inspection</h4>
                        <a href="@Url.Action("InsAssets", "Assets", new {area = "",assetsid = assetsid?.Assets?.FirstOrDefault()?.AssetId,epdetailid=Model?.FirstOrDefault()?.EPDetailId,inspectionid= inspectionid >0?inspectionid: 0})" class="btn button1">Inspect</a>
                    </div>
                    <div class="card">
                        <img class="inspQuestionimg" alt="Barcode/Asset ID" src="https://files.crxweb.com/static/images/services/barcode_icon.png">
                        <h4>Barcode/Asset ID</h4>
                        <a href="@Url.Action("Inspectionbybarcode", "Assets", new {area = ""})" class="btn button1">Inspect</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</html>


<script>

    $("#ModalPopUpAssets").click(function () {
        $('#ModalPopUp').modal('show');
    })



    var btnAddDoc = $("#btnAddDoc");
    var btnAddDocMisc = $("#btnAddDocMisc");
    @{
        var epId = Model.FirstOrDefault().EPDetailId;
        var inspid = inspectionid;
    }
    var docUploadUrl = '@Url.Action("EPDocs", "Goal")?epId=' + @Model.FirstOrDefault().EPDetailId + '&inspectionid=' + @inspectionid; @*//'@Url.Action("EPDocs", "Goal", new {epId =Model.FirstOrDefault().EPDetailId,inspectionid=inspectionid})';*@

        btnAddDoc.click(function() {
            @if (Model.FirstOrDefault().EPDetails.IsDocRequired)
            {
                @:confirmFilePopUp();
            }
            else
            {
                @:loadFilePopup();
            }
    });

     btnAddDocMisc.click(function() {

            @*@if (Model.FirstOrDefault().EPDetails.IsDocRequired)
            {
                @:confirmFilePopUp();

            }
            else*@
            @{
                @:loadFilePopup();
            }
        });

 var loadFilePopup = function (uploadDocType) {
            if (uploadDocType === "2") {
                LoadRecentEpFiles();
            } else {
                LoadRecentFiles();
            }
        };


        function LoadRecentEpFiles() {
            var modelContainer = $("#modal-container");
            modelContainer.empty();
            const recentFiles = CRxUrls.Goal_EpDocHistory + "?epId=" + @Model.FirstOrDefault().EPDetailId;
            $.get(recentFiles,
                function(data) {
                    modelContainer.html('');
                    modelContainer.html(data);
                    modelContainer.fadeIn('fast');
                    modelContainer.modal('show');
                });
        }

 var confirmFilePopUp = function() {
            swal({
                    html: true,
                    title: "Add Document",
                    text:
                        '<div class="container1 epssweetpopup"> <div class="radio1">  <input class="radio" id="radio-1" name="doctyperadio" type="radio" checked value="1">' +
                            '<label for="radio-1" class="radio-label">Required document <br />(@Model.FirstOrDefault().DocName)</label>' +
                            '</div> ' +
                            '<div class= "radio1" > ' +
                            '<input id="radio-3" class="radio" name="doctyperadio" type="radio" value="2"> ' +
                            '<label for= "radio-3" class= "radio-label">Re-use previously reviewed document</label> ' +
                            '</div>' +
                            '<div class= "radio1 hide" > ' +
                            '<input id="radio-2" class="radio" name="doctyperadio" type="radio" value="0"> ' +
                            '<label for= "radio-2" class= "radio-label"> Misc. Document</label> ' +
                            '</div>' +
                            //'<div class= "radio1" > ' +
                            //'<input id="radio-2" class="radio" name="doctyperadio" type="radio" value="2"> ' +
                            //'<label for= "radio-2" class= "radio-label"> Sample document</label> ' +
                            //' </div>' +
                            ' </div>',
                    type: "info",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "Continue",
                    cancelButtonText: "Cancel",
                    closeOnConfirm: false,
                    closeOnCancel: true
                },
                function(isConfirm) {
                    if (isConfirm) {
                        debugger;
                        const uploadDocType = $('input[name=doctyperadio]:checked').val();
                        $("#rbnUploadtype").val(uploadDocType);
                        @*if (uploadDocType != "0" && '@Model.EpTransStatus' == "C") {
                            showFileUploadPopUp(uploadDocType);
                        } else {*@
                            swal.close();
                            loadFilePopup(uploadDocType);
                        //}
                    }
                });
        }

    function fileUploadSuccess(tFiles, selectedFiles) {
        debugger
     console.log(tFiles, selectedFiles);
            var uploadDocType = $("#rbnUploadtype").val();
            if (uploadDocType === "1" || uploadDocType === "2") {
                localStorage.setItem('epDocUploadFiles', JSON.stringify(selectedFiles));
                window.location.href = docUploadUrl;
            } else {
                AddMiscEPDocs(selectedFiles, '@Model.FirstOrDefault().EPDetailId', '108');
            }
        }





        var AddMiscEPDocs = function(files, epId, docTypeId) {
            debugger;
            var fileswithcomma = files.join(",");
            $.ajax({
                url: '@Url.Action("AddMiscEPDocuments", "Goal")',
                type: "POST",
                dataType: "JSON",
                data: { files: fileswithcomma, epId: epId, docTypeId: docTypeId },
                success: function(data) {
                    if (data.Result) {
                        if ("@Model.FirstOrDefault().EPDetails.Inspection.SubStatus" == "IN") {
                            swalalert("File has been uploaded successfully.");
                        }
                        else {
                            swalalert("File has been uploaded successfully. You can review this file on EP review Page.");
                        }

                        location.reload(true);
                    }
                }
            });
        };
    $(".delete").click(function () {

        var ctrName = $(this);
        var activityId = ctrName.attr("activityId");

        swal({
            html: true,
            title: "Delete Document",
            text: 'Are you sure to delete this file?',
            type: "info",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes",
            cancelButtonText: "Cancel",
            closeOnConfirm: true,
            closeOnCancel: true
        },
            function (isConfirm) {
                if (isConfirm) {
                    $.ajax({
                       // url: '/Goal/RemoveEpDoc' + "?activityId=" + activityId,
                         url: '@Url.Action("RemoveEpDoc", "Goal")' ,
                            type: "POST",
                            dataType: "JSON",
                            data: { activityId: activityId,  __RequestVerificationToken: $('input[name=' + $.Constants.RequestVerificationToken + ']').val() },
                        success: function (data) {
                            ctrName.closest("tr").remove();
                            $('li[activityid="' + activityId + '"]').remove();
                            swalalert("File has been successfully deleted.");
                            location.reload();

                        }
                    });
                }
            });
    });
</script>

