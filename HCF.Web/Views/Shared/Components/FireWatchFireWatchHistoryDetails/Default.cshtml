@model List<HCF.BDO.TimeSlots>


    <table class="table table-bordered table-striped" id="firewatchTable">
        <thead>
            <tr>
                <th width="70px">Start</th>
                <th width="70px">Finish</th>
                <th>Officer</th>
                <th>Areas </th>
                <th>Round Completed</th>
                <th>Comments</th>

            </tr>
        </thead>
        <tbody>
            @foreach (HCF.BDO.TimeSlots oTimeSlot in Model)
            {
                <tr>
                    <td>@oTimeSlot.Start.ToClientTime().ToString("t")</td>
                    <td>@oTimeSlot.End.ToClientTime().ToString("t") </td>
                    @foreach (var item in oTimeSlot.FireWatchLog)
                    {
                        if (item.FWLogId > 0)
                        {
                            <td width="15%">@item.InspectorName</td>
                            <td width="35%">
                                @item.Area.Substring(0, Math.Min(item.Area.Length, 100))
                                @if (item.Area.Length > 100)
                                {
                                    <a href="javascript:void(0);"
                                       tabindex="0" data-trigger="focus"
                                       class="descriptions" rel='popover'
                                       data-placement='right'
                                       data-original-title='@item.InspectorName'
                                       data-content='@item.Area'>@($"{"...See More"}")</a>
                                }

                            </td>
                            <td width="25%">@item.RoundInspDate.Value.ToClientTime().ToString("t")</td>
                            <td width="25%">@item.Comment</td>
                        }
                        else
                        {
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        }
                    }

                </tr>
            }
        </tbody>
    </table>

<div style="display:none;">
    <span id="reportDate">@($"{"Report Date"} : {Model.FirstOrDefault().Start.ToClientTime().ToShortDateString()}")</span>
</div>
<div style="display:none">
    <span id="dvgeneratedby">@($"{"\n\n\n Generated From: CRx    Generated by"} : {HCF.Web.Base.UserSession.CurrentUser.Name}")</span>
</div>

<div id="pop-up"></div>
<script>
    $(function () {
        var moveLeft = -250;
        var moveDown = -70;

        //getBase64FromImageUrl();
        $('.descriptions').popover({
            trigger: 'focus'
        });

        $('.trigger').hover(function (e) {
            var id = $(this).attr('id');
            var desc = $(this).val();
            if (desc.length > 0) {
                $('div#pop-up').text(desc).show();
            }
        }, function () {
            $('div#pop-up').hide();
        });

        $('.trigger').mousemove(function (e) {
            $("div#pop-up").css('top', e.pageY + moveDown).css('left', e.pageX + moveLeft);
        });


        var dtable = $('#firewatchTable').DataTable({
            "searching": false,
            "lengthChange": false,
            "pageLength": 25,
            "bPaginate": $('#firewatchTable tbody tr').length > 25,
            "bInfo": false,
            "aaSorting": [],
            "oSearch": { "bSmart": false },
            "language": {
                "emptyTable": "No data available in table"
            },
            dom: "<'row'<'col-sm-3'l><'col-sm-3'f><'col-sm-6'p>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-5'i>>" + "Blfrtip",
            buttons: [
                {
                    extend: 'pdfHtml5',
                    orientation: 'portrait',
                    //pageSize: 'LEGAL',
                    title: 'Fire Watch Report',
                    messageTop: function () {
                        return $("#reportDate").text();
                    },
                    messageBottom: function () {
                        return $("#dvgeneratedby").text();
                    },
                    customize: function (doc) {
                        //Remove the title created by datatTables
                        doc.content.splice(0, 1);
                        //Create a date string that we use in the footer. Format is dd-mm-yyyy
                        var now = new Date();
                        var jsDate = now.getDate() + '-' + (now.getMonth() + 1) + '-' + now.getFullYear();
                        // Logo converted to base64
                        //var logo = $("#logoimgbase64").val();
                        debugger;
                        var logo = localStorage.getItem("logoimgbase64");//getBase64FromImageUrl();
                        console.log(logo);
                        // The above call should work, but not when called from codepen.io
                        // So we use a online converter and paste the string in.
                        // Done on http://codebeautify.org/image-to-base64-converter
                        // It's a LONG string scroll down to see the rest of the code !!!
                        //var logo = '';
                        // A documentation reference can be found at
                        // https://github.com/bpampuch/pdfmake#getting-started
                        // Set page margins [left,top,right,bottom] or [horizontal,vertical]
                        // or one number for equal spread
                        // It's important to create enough space at the top for a header !!!
                        doc.pageMargins = [20, 60, 20, 30];
                        // Set the font size fot the entire document
                        doc.defaultStyle.fontSize = 8;
                        // Set the fontsize for the table header
                        doc.styles.tableHeader.fontSize = 7;
                        // Create a header object with 3 columns
                        // Left side: Logo
                        // Middle: brandname
                        // Right side: A document title
                        doc['header'] = (function () {
                            return {
                                columns: [
                                    { image: logo, width: 40 },
                                    {
                                        alignment: 'left',
                                        italics: true,
                                        text: getOrgName('@HCF.Web.Base.UserSession.CurrentOrg.Name'), @*text: '@HCF.Web.Base.UserSession.CurrentOrg.Name',*@
                                        fontSize: 14,
                                        margin: [0, 6, 0, 0],
                                        width:200,
                                    },
                                    {
                                        alignment: 'middle',
                                        fontSize: 14,
                                        text: 'Fire Watch Report',
                                        margin: [0, 6 , 0 , 0]
                                    }
                                ],
                                margin: 20
                            }
                        });

                        doc['footer'] = (function (page, pages) {
                            return {
                                columns: [
                                    {
                                        alignment: 'left',
                                        text: ['Created on: ', { text: jsDate.toString() }]
                                    },
                                    {
                                        alignment: 'right',
                                        text: [{ text: $.Constants.PDF_Footer_Msg_Fire_Watch_Portal_module }]
                                    }
                                ],
                                margin: 20
                            }
                        });

                        var objLayout = {};
                        objLayout['hLineWidth'] = function (i) { return .5; };
                        objLayout['vLineWidth'] = function (i) { return .5; };
                        objLayout['hLineColor'] = function (i) { return '#aaa'; };
                        objLayout['vLineColor'] = function (i) { return '#aaa'; };
                        objLayout['paddingLeft'] = function (i) { return 4; };
                        objLayout['paddingRight'] = function (i) { return 4; };
                        doc.content[0].layout = objLayout;
                    }
                },

                {
                    extend: 'excel',
                    title: 'Fire Watch Report',
                    messageTop: function () {
                        return $("#reportDate").text();
                    },
                    messageBottom: function () {
                        return $("#dvgeneratedby").text();
                    },

                }
            ]
        });
    });




</script>